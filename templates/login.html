<?php
session_start();

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $email = filter_var($_POST['email'], FILTER_SANITIZE_EMAIL);

    if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
        die("❌ Invalid email.");
    }

    $_SESSION['email'] = $email;

    // Send email to Flask backend
    $backend_url = "http://localhost:5000/contact";  // adjust if deployed
    $data = json_encode([
        "name" => "LandingLogin",
        "email" => $email,
        "message" => "User logged in via landing page"
    ]);

    $options = [
        "http" => [
            "header"  => "Content-Type: application/json\r\n",
            "method"  => "POST",
            "content" => $data
        ]
    ];
    $context  = stream_context_create($options);
    $result = file_get_contents($backend_url, false, $context);

    header("Location: index.php");
    exit;
}
?>
